<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulación Profesional de Construcción Arquitectónica</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2c3e50;
            --accent: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --text: #333;
            --gray: #95a5a6;
            --concrete: #95a5a6;
            --brick: #c0392b;
            --wood: #d2b48c;
            --glass: #87CEEB;
            --steel: #bdc3c7;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background-color: #f5f7fa;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header con efectos */
        header {
            text-align: center;
            margin-bottom: 2.5rem;
            position: relative;
            background: linear-gradient(135deg, var(--secondary), var(--dark));
            color: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shine 8s infinite linear;
        }

        @keyframes shine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            position: relative;
            display: inline-block;
            font-weight: 700;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 4px;
            background: var(--primary);
            border-radius: 2px;
        }

        .subtitle {
            color: rgba(255,255,255,0.8);
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Dashboard principal */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        /* Área de simulación 3D */
        .simulation-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            height: 700px;
            position: relative;
            overflow: hidden;
            perspective: 1000px;
        }

        .construction-site {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.1);
            transform-style: preserve-3d;
        }

        /* Sistema de clima */
        .weather {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        .sun {
            position: absolute;
            top: 10%;
            right: 10%;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            border-radius: 50%;
            box-shadow: 0 0 40px #FFD700;
            z-index: 1;
        }

        .cloud {
            position: absolute;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
            filter: blur(5px);
        }

        .rain {
            position: absolute;
            width: 2px;
            height: 15px;
            background: rgba(255,255,255,0.6);
            animation: rainFall linear infinite;
        }

        @keyframes rainFall {
            0% { transform: translateY(-100px); }
            100% { transform: translateY(700px); }
        }

        /* Elementos del terreno */
        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 25%;
            background: linear-gradient(to bottom, #5D4037, #4E342E);
            z-index: 2;
            transform-style: preserve-3d;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.3);
        }

        .grass {
            position: absolute;
            bottom: 25%;
            width: 100%;
            height: 15px;
            background: linear-gradient(to right, 
                #2E8B57, #3CB371, #2E8B57, #3CB371, #2E8B57);
            z-index: 3;
            box-shadow: 0 -5px 15px rgba(46, 139, 87, 0.4);
        }

        /* Elementos de construcción con efectos 3D */
        .foundation {
            position: absolute;
            bottom: 25%;
            left: 30%;
            width: 40%;
            height: 6%;
            background: linear-gradient(to right, #808080, #696969, #808080);
            z-index: 4;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: scaleY(0) translateZ(20px);
            transform-origin: bottom;
            transition: transform 1.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-radius: 3px;
        }

        .foundation::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.5), transparent);
        }

        .foundation.visible {
            transform: scaleY(1) translateZ(20px);
        }

        .walls {
            position: absolute;
            bottom: 31%;
            left: 30%;
            width: 40%;
            height: 35%;
            background: 
                linear-gradient(90deg, 
                    rgba(210,180,140,0.8) 0%, 
                    rgba(245,222,179,0.9) 50%, 
                    rgba(210,180,140,0.8) 100%),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect width="100" height="100" fill="%23f5deb3"/><path d="M0,20 L100,20 M0,40 L100,40 M0,60 L100,60 M0,80 L100,80 M20,0 L20,100 M40,0 L40,100 M60,0 L60,100 M80,0 L80,100" stroke="%23d2b48c" stroke-width="1" opacity="0.6"/></svg>');
            background-size: 50px 50px;
            z-index: 5;
            border: 3px solid #d2b48c;
            border-bottom: none;
            clip-path: polygon(0% 100%, 0% 0%, 100% 0%, 100% 100%);
            transform: scaleY(0) translateZ(30px);
            transform-origin: bottom;
            transition: transform 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .walls.visible {
            transform: scaleY(1) translateZ(30px);
        }

        .roof {
            position: absolute;
            bottom: 66%;
            left: 25%;
            width: 50%;
            height: 18%;
            background: 
                linear-gradient(135deg, rgba(139,0,0,0.8), rgba(102,0,0,0.9)),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect width="100" height="100" fill="%238B0000"/><path d="M0,20 L100,20 M0,40 L100,40 M0,60 L100,60 M0,80 L100,80" stroke="%23660000" stroke-width="1.5"/></svg>');
            background-size: 60px 60px;
            clip-path: polygon(0% 100%, 50% 0%, 100% 100%);
            z-index: 6;
            transform: translateY(-50px) translateZ(40px);
            opacity: 0;
            transition: all 1.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .roof.visible {
            transform: translateY(0) translateZ(40px);
            opacity: 1;
        }

        /* Ventanas con reflejos */
        .windows {
            position: absolute;
            width: 8%;
            height: 12%;
            background: 
                linear-gradient(135deg, 
                    rgba(135,206,235,0.9), 
                    rgba(176,224,230,0.95)),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect width="100" height="100" fill="%2387CEEB"/><path d="M50,0 L50,100 M0,50 L100,50" stroke="%234682B4" stroke-width="2" opacity="0.6"/></svg>');
            background-size: 20px 20px;
            border: 3px solid #4682B4;
            z-index: 7;
            box-shadow: 
                inset 0 0 25px rgba(0, 0, 0, 0.2), 
                0 0 15px rgba(70, 130, 180, 0.4),
                5px 5px 20px rgba(0,0,0,0.2);
            transform: scale(0) translateZ(50px);
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-radius: 3px;
            overflow: hidden;
        }

        .windows::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255,255,255,0) 45%,
                rgba(255,255,255,0.8) 50%,
                rgba(255,255,255,0) 55%
            );
            transform: rotate(30deg);
            animation: windowShine 8s infinite;
        }

        @keyframes windowShine {
            0% { transform: translateX(-100%) rotate(30deg); }
            100% { transform: translateX(100%) rotate(30deg); }
        }

        .windows.visible {
            transform: scale(1) translateZ(50px);
        }

        .window-frame {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid #4682B4;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            z-index: 1;
        }

        .window-pane {
            border: 1px solid rgba(70, 130, 180, 0.6);
            background: rgba(255,255,255,0.1);
        }

        /* Puerta con detalles */
        .door {
            position: absolute;
            bottom: 31%;
            left: 45%;
            width: 10%;
            height: 22%;
            background: 
                linear-gradient(135deg, 
                    rgba(139,69,19,0.9), 
                    rgba(160,82,45,0.95)),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect width="100" height="100" fill="%238B4513"/><path d="M10,10 L90,10 L90,90 L10,90 Z M30,30 L70,30 L70,70 L30,70 Z" stroke="%235D2906" stroke-width="2" fill="%23A0522D"/></svg>');
            background-size: 30px 30px;
            z-index: 7;
            border: 3px solid #5D2906;
            border-bottom: none;
            box-shadow: 
                inset 0 0 20px rgba(0, 0, 0, 0.4),
                0 5px 15px rgba(0,0,0,0.3);
            transform: translateY(50px) translateZ(50px);
            opacity: 0;
            transition: all 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-radius: 3px 3px 0 0;
        }

        .door.visible {
            transform: translateY(0) translateZ(50px);
            opacity: 1;
        }

        .door-knob {
            position: absolute;
            right: 15%;
            top: 50%;
            width: 8%;
            height: 8%;
            background: radial-gradient(circle, #CD7F32, #8B4513);
            border-radius: 50%;
            box-shadow: 
                inset 0 0 5px rgba(0,0,0,0.3),
                0 2px 5px rgba(0,0,0,0.2);
            z-index: 2;
        }

        /* Personajes y vehículos mejorados */
        .worker {
            position: absolute;
            width: 30px;
            height: 60px;
            bottom: 25%;
            left: 10%;
            z-index: 20;
            display: none;
            transform-style: preserve-3d;
            transform: translateZ(25px);
        }

        .worker-body {
            position: absolute;
            width: 22px;
            height: 35px;
            bottom: 0;
            left: 4px;
            background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
            border-radius: 5px 5px 0 0;
            box-shadow: 0 3px 5px rgba(0,0,0,0.2);
        }

        .worker-head {
            position: absolute;
            width: 18px;
            height: 18px;
            bottom: 35px;
            left: 6px;
            background: linear-gradient(to bottom, #FFD399, #E2B879);
            border-radius: 50%;
            box-shadow: 0 2px 3px rgba(0,0,0,0.2);
        }

        .worker-helmet {
            position: absolute;
            width: 22px;
            height: 12px;
            bottom: 43px;
            left: 4px;
            background: linear-gradient(to bottom, var(--danger), #c0392b);
            border-radius: 50% 50% 0 0;
            box-shadow: 0 3px 5px rgba(0,0,0,0.2);
        }

        .worker-helmet::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 5px;
            width: 12px;
            height: 3px;
            background: rgba(255,255,255,0.4);
            border-radius: 2px;
        }

        .worker-arm {
            position: absolute;
            width: 10px;
            height: 18px;
            background: linear-gradient(to bottom, var(--primary-dark), var(--primary));
            box-shadow: 0 2px 3px rgba(0,0,0,0.2);
        }

        .worker-arm.left {
            bottom: 15px;
            left: -5px;
            transform-origin: top right;
            animation: armSwingLeft 1.2s infinite alternate;
            border-radius: 3px 0 0 3px;
        }

        .worker-arm.right {
            bottom: 15px;
            right: -5px;
            transform-origin: top left;
            animation: armSwingRight 1.2s infinite alternate 0.6s;
            border-radius: 0 3px 3px 0;
        }

        @keyframes armSwingLeft {
            0% { transform: rotate(-25deg); }
            100% { transform: rotate(15deg); }
        }

        @keyframes armSwingRight {
            0% { transform: rotate(15deg); }
            100% { transform: rotate(-25deg); }
        }

        /* Maquinaria pesada */
        .excavator {
            position: absolute;
            width: 100px;
            height: 60px;
            bottom: 25%;
            left: -120px;
            z-index: 15;
            display: none;
            transform-style: preserve-3d;
            transform: translateZ(20px);
        }

        .excavator-base {
            position: absolute;
            width: 70px;
            height: 25px;
            bottom: 0;
            left: 15px;
            background: linear-gradient(to bottom, #555, #333);
            border-radius: 5px;
        }

        .excavator-cabin {
            position: absolute;
            width: 25px;
            height: 20px;
            bottom: 25px;
            left: 40px;
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
            border-radius: 3px 3px 0 0;
        }

        .excavator-arm {
            position: absolute;
            width: 8px;
            height: 40px;
            bottom: 45px;
            left: 45px;
            background: linear-gradient(to bottom, #AAA, #777);
            transform-origin: bottom;
            animation: excavatorArm 4s infinite;
        }

        @keyframes excavatorArm {
            0%, 100% { transform: rotate(-20deg); }
            50% { transform: rotate(30deg); }
        }

        .excavator-bucket {
            position: absolute;
            width: 15px;
            height: 10px;
            bottom: 85px;
            left: 38px;
            background: linear-gradient(to bottom, #777, #555);
            border-radius: 0 0 5px 5px;
        }

        .excavator-track {
            position: absolute;
            width: 80px;
            height: 15px;
            bottom: -5px;
            left: 10px;
            background: 
                repeating-linear-gradient(90deg, 
                    #333 0%, #333 10%, 
                    #555 10%, #555 20%);
            border-radius: 3px;
            animation: trackMove 2s linear infinite;
        }

        @keyframes trackMove {
            0% { background-position: 0 0; }
            100% { background-position: 20px 0; }
        }

        .truck {
            position: absolute;
            width: 100px;
            height: 50px;
            bottom: 27%;
            left: -150px;
            z-index: 15;
            display: none;
            transform-style: preserve-3d;
            transform: translateZ(20px);
        }

        .truck-cabin {
            position: absolute;
            width: 30px;
            height: 25px;
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
            border-radius: 5px 0 0 0;
        }

        .truck-bed {
            position: absolute;
            left: 30px;
            width: 70px;
            height: 25px;
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
            border-radius: 0 5px 0 0;
        }

        .truck-bed::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255,255,255,0.3), 
                transparent);
        }

        .truck-window {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 20px;
            height: 12px;
            background: linear-gradient(135deg, #87CEEB, #B0E0E6);
            border-radius: 2px;
        }

        .wheel {
            position: absolute;
            width: 15px;
            height: 15px;
            bottom: -7px;
            background: radial-gradient(circle, #333, #000);
            border-radius: 50%;
            border: 2px solid #555;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .wheel::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            border-radius: 50%;
            background: radial-gradient(circle, #555, #333 70%);
        }

        .wheel.front {
            left: 20px;
            animation: wheelSpin 1s linear infinite;
        }

        .wheel.rear {
            left: 70px;
            animation: wheelSpin 1s linear infinite;
        }

        @keyframes wheelSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Partículas y efectos */
        .particles-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 30;
        }

        .construction-particle {
            position: absolute;
            border-radius: 50%;
            z-index: 30;
            opacity: 0;
            transform-style: preserve-3d;
        }

        .dust-particle {
            background: rgba(210,180,140,0.8);
        }

        .concrete-particle {
            background: rgba(149,165,166,0.9);
        }

        .wood-particle {
            background: rgba(210,180,140,0.9);
        }

        .brick-particle {
            background: rgba(192,57,43,0.9);
        }

        /* Panel de control mejorado */
        .control-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            height: 700px;
            display: flex;
            flex-direction: column;
            transform-style: preserve-3d;
        }

        .progress-container {
            width: 100%;
            background: #ecf0f1;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress-bar {
            height: 22px;
            background: linear-gradient(90deg, 
                var(--success), 
                #27ae60, 
                var(--success));
            border-radius: 8px;
            width: 0%;
            transition: width 0.7s cubic-bezier(0.65, 0, 0.35, 1);
            position: relative;
            overflow: hidden;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,0.4) 50%, 
                rgba(255,255,255,0) 100%
            );
            animation: progressShine 3s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 1.5rem;
        }

        button {
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            transform-style: preserve-3d;
            transform: translateZ(0);
        }

        button i {
            font-size: 1.1rem;
        }

        button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: translateZ(0) !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
        }

        button:not(:disabled):hover {
            transform: translateY(-3px) translateZ(10px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        button:not(:disabled):active {
            transform: translateY(1px) translateZ(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(to bottom, var(--secondary), #1a252f);
            color: white;
        }

        .btn-accent {
            background: linear-gradient(to bottom, var(--accent), #c0392b);
            color: white;
        }

        .btn-success {
            background: linear-gradient(to bottom, var(--success), #219653);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(to bottom, var(--warning), #e67e22);
            color: white;
        }

        .btn-dark {
            background: linear-gradient(to bottom, var(--dark), #2c3e50);
            color: white;
        }

        .weather-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 1rem;
        }

        .weather-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
            border-radius: 6px;
        }

        /* Información de etapa */
        .stage-info {
            background: linear-gradient(135deg, var(--dark), var(--secondary));
            color: white;
            padding: 1.5rem;
            border-radius: 8px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            box-shadow: 
                inset 0 0 20px rgba(0, 0, 0, 0.2),
                0 5px 15px rgba(0,0,0,0.2);
            transform-style: preserve-3d;
            transform: translateZ(10px);
            overflow: hidden;
        }

        .stage-info::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(
                circle, 
                rgba(255,255,255,0.05) 0%, 
                transparent 70%
            );
            animation: rotateShine 20s linear infinite;
        }

        @keyframes rotateShine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stage-title {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            position: relative;
            padding-bottom: 0.5rem;
            z-index: 1;
        }

        .stage-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--primary);
            border-radius: 3px;
        }

        .stage-description {
            margin-bottom: 1.5rem;
            line-height: 1.7;
            z-index: 1;
        }

        /* Sección de IA */
        .ai-section {
            background: rgba(0, 0, 0, 0.25);
            padding: 1.2rem;
            border-radius: 6px;
            margin-top: auto;
            backdrop-filter: blur(5px);
            z-index: 1;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .ai-title {
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #bdc3c7;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-comment {
            font-style: italic;
            color: #ecf0f1;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .materials-list {
            margin-top: 1rem;
            padding-left: 1.5rem;
        }

        .materials-list li {
            margin-bottom: 0.6rem;
            position: relative;
            list-style-type: none;
        }

        .materials-list li::before {
            content: '▹';
            position: absolute;
            left: -1.2rem;
            color: var(--primary);
            font-size: 1.1rem;
        }

        /* Notificaciones */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--secondary);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 300px;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification i {
            font-size: 1.2rem;
        }

        .notification.success {
            background: var(--success);
        }

        .notification.warning {
            background: var(--warning);
        }

        .notification.error {
            background: var(--danger);
        }

        /* Modo nocturno */
        .night-mode .construction-site {
            background: linear-gradient(to bottom, #0F2027, #203A43, #2C5364);
        }

        .night-mode .sun {
            display: none;
        }

        .night-mode .moon {
            display: block;
            position: absolute;
            top: 10%;
            right: 10%;
            width: 50px;
            height: 50px;
            background: #F5F5F5;
            border-radius: 50%;
            box-shadow: 0 0 20px #F5F5F5;
            z-index: 1;
        }

        .night-mode .moon::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 10px;
            width: 15px;
            height: 15px;
            background: #0F2027;
            border-radius: 50%;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .simulation-container, .control-panel {
                height: 500px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
        }

         
       .mini-back-button {
        width: 200px;
        height: 200px;
        font-size: 14px;
        background-color: #4CAF50; /* Color verde */
        color: white;
        border: none;
        border-radius: 39px;
        cursor: pointer;
        transition: background-color 0.3s; /* Transición suave */
    }
    .mini-back-button:hover {
        background-color: #45a049; /* Color más oscuro al pasar el cursor */
    }
    </style>
</head>
<button class="mini-back-button" onclick="window.location.href='index.html'">
    <h1>
Volver atrás
    </h1>
</button>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-hard-hat"></i> Simulación Profesional de Construcción</h1>
            <p class="subtitle">Visualización interactiva del proceso completo de construcción de una vivienda con inteligencia arquitectónica</p>
        </header>
        
        <div class="dashboard">
            <div class="simulation-container">
                <div class="construction-site">
                    <!-- Clima y ambiente -->
                    <div class="weather">
                        <div class="sun"></div>
                        <div class="cloud" style="top: 15%; left: 10%; width: 80px; height: 40px;"></div>
                        <div class="cloud" style="top: 25%; left: 50%; width: 100px; height: 50px;"></div>
                    </div>
                    
                    <!-- Terreno -->
                    <div class="ground"></div>
                    <div class="grass"></div>
                    
                    <!-- Estructura de la casa -->
                    <div class="foundation" id="foundation"></div>
                    <div class="walls" id="walls"></div>
                    <div class="roof" id="roof"></div>
                    
                    <!-- Ventanas y puertas -->
                    <div class="windows" id="window1" style="left: 35%; bottom: 50%;">
                        <div class="window-frame">
                            <div class="window-pane"></div>
                            <div class="window-pane"></div>
                            <div class="window-pane"></div>
                            <div class="window-pane"></div>
                        </div>
                    </div>
                    <div class="windows" id="window2" style="left: 57%; bottom: 50%;">
                        <div class="window-frame">
                            <div class="window-pane"></div>
                            <div class="window-pane"></div>
                            <div class="window-pane"></div>
                            <div class="window-pane"></div>
                        </div>
                    </div>
                    <div class="door" id="door">
                        <div class="door-knob"></div>
                    </div>
                    
                    <!-- Personal y maquinaria -->
                    <div class="worker" id="worker">
                        <div class="worker-head"></div>
                        <div class="worker-helmet"></div>
                        <div class="worker-body"></div>
                        <div class="worker-arm left"></div>
                        <div class="worker-arm right"></div>
                    </div>
                    
                    <div class="worker" id="worker2" style="left: 20%;">
                        <div class="worker-head"></div>
                        <div class="worker-helmet"></div>
                        <div class="worker-body"></div>
                        <div class="worker-arm left"></div>
                        <div class="worker-arm right"></div>
                    </div>
                    
                    <div class="excavator" id="excavator">
                        <div class="excavator-base"></div>
                        <div class="excavator-track"></div>
                        <div class="excavator-cabin"></div>
                        <div class="excavator-arm"></div>
                        <div class="excavator-bucket"></div>
                    </div>
                    
                    <div class="truck" id="truck">
                        <div class="truck-cabin">
                            <div class="truck-window"></div>
                        </div>
                        <div class="truck-bed"></div>
                        <div class="wheel front"></div>
                        <div class="wheel rear"></div>
                    </div>
                    
                    <!-- Partículas y efectos -->
                    <div id="particles-container"></div>
                </div>
            </div>
            
            <div class="control-panel">
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar">0% Completado</div>
                </div>
                
                <div class="controls">
                    <button id="prevStage" class="btn-secondary">
                        <i class="fas fa-arrow-left"></i> Etapa Anterior
                    </button>
                    <button id="nextStage" class="btn-primary">
                        <i class="fas fa-arrow-right"></i> Siguiente Etapa
                    </button>
                    <button id="autoBuild" class="btn-accent">
                        <i class="fas fa-robot"></i> Construcción Automática
                    </button>
                    <button id="reset" class="btn-secondary">
                        <i class="fas fa-redo"></i> Reiniciar
                    </button>
                </div>
                
                <div class="weather-controls">
                    <button id="dayMode" class="btn-warning">
                        <i class="fas fa-sun"></i> Día
                    </button>
                    <button id="nightMode" class="btn-dark">
                        <i class="fas fa-moon"></i> Noche
                    </button>
                    <button id="rainMode" class="btn-primary">
                        <i class="fas fa-cloud-rain"></i> Lluvia
                    </button>
                </div>
                
                <div class="stage-info" id="stageInfo">
                    <h3 class="stage-title" id="stageTitle">Preparación del Terreno</h3>
                    <p class="stage-description" id="stageDescription">Etapa inicial de preparación del terreno que incluye limpieza, replanteo, excavación y compactación del suelo según especificaciones técnicas.</p>
                    
                    <div class="ai-section">
                        <div class="ai-title">
                            <i class="fas fa-robot"></i> ASISTENTE DE CONSTRUCCIÓN IA
                        </div>
                        <p class="ai-comment" id="aiComment">Recomendación: Realice un estudio geotécnico completo para determinar la capacidad portante del suelo. Compacte en capas de no más de 20cm con humedad óptima (-2%/+1% del óptimo Proctor).</p>
                        
                        <div class="materials-title" style="font-size: 0.9rem; color: #bdc3c7; margin-bottom: 0.5rem;">
                            <i class="fas fa-tools"></i> Materiales y Equipos:
                        </div>
                        <ul class="materials-list" id="materialsList">
                            <li>Excavadora CAT 320 (1.2m³)</li>
                            <li>Compactador Wacker BS60y</li>
                            <li>Estación total Leica TS16</li>
                            <li>Material granular (Base 20cm)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notificación -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Mensaje de notificación</span>
    </div>

    <script>
        // Datos completos de las etapas de construcción
        const stages = [
            {
                title: "Preparación del Terreno",
                description: "Limpieza, replanteo topográfico, excavación y compactación del terreno para asegurar una base estable. Incluye movimiento de tierras y nivelación con tolerancia de ±2cm.",
                aiComment: "Recomendación: Realice un estudio geotécnico completo para determinar la capacidad portante del suelo. Compacte en capas de no más de 20cm con humedad óptima (-2%/+1% del óptimo Proctor). Considere sistemas de drenaje perimetral si el nivel freático es alto.",
                materials: [
                    "Excavadora CAT 320 (1.2m³)",
                    "Compactador Wacker BS60y",
                    "Estación total Leica TS16",
                    "Material granular (Base 20cm)",
                    "Geotextil ANTITERRA 400 (si necesario)"
                ],
                progress: 10,
                duration: 5,
                action: function() {
                    showNotification("Iniciando preparación del terreno...", "success");
                    
                    // Mostrar maquinaria y trabajadores
                    document.getElementById('worker').style.display = 'block';
                    document.getElementById('worker2').style.display = 'block';
                    document.getElementById('excavator').style.display = 'block';
                    document.getElementById('truck').style.display = 'block';
                    
                    // Animaciones
                    animateWorker();
                    animateWorker2();
                    animateExcavator();
                    animateTruck();
                    
                    // Efectos de excavación
                    createParticles(80, '#5D4037', 'bottom', false, 1500);
                    
                    // Sonido de excavación (simulado visualmente)
                    flashElement(document.querySelector('.ground'), 6, 300);
                }
            },
            {
                title: "Cimentación",
                description: "Construcción de cimientos corridos de hormigón armado H-30 con encofrado metálico. Zapata de 60cm base x 30cm altura con armadura principal Φ12mm cada 20cm y estribos Φ8mm cada 15cm.",
                aiComment: "Recomendación: Utilice hormigón H-30 con aditivo superplastificante (1.5% peso cemento) para mejor trabajabilidad. Curado húmedo por 7 días mínimo. Verifique posición de armaduras con distanciadores plásticos (4cm recubrimiento).",
                materials: [
                    "Hormigón H-30 (300 kg/cm² @28d)",
                    "Acero corrugado Φ12mm y Φ8mm",
                    "Encofrados metálicos PERI",
                    "Vibrador de hormigón Wacker",
                    "Distanciadores plásticos"
                ],
                progress: 25,
                duration: 7,
                action: function() {
                    showNotification("Vertiendo cimentación de hormigón...", "success");
                    
                    const foundation = document.getElementById('foundation');
                    foundation.style.display = 'block';
                    setTimeout(() => {
                        foundation.classList.add('visible');
                    }, 100);
                    
                    // Efectos de construcción
                    createParticles(50, '#696969', 'foundation', false, 1200);
                    flashElement(foundation, 4, 400);
                    
                    // Cambiar actividad de trabajadores
                    changeWorkerActivity('foundation');
                }
            },
            {
                title: "Estructura y Muros",
                description: "Elevación de muros de bloques de hormigón celular Ytong 20cm (λ=0.11W/mK) con refuerzos verticales Φ10mm cada 60cm. Juntas verticales y horizontales con mortero cola especial de 3mm.",
                aiComment: "Recomendación: Nivele perfectamente la primera hilada con láser. Use sierra de disco diamantado para cortes precisos. Aplique imprimación de adherencia antes del revoque. Considere aislamiento térmico adicional en climas extremos.",
                materials: [
                    "Bloques Ytong 20x25x60cm",
                    "Mortero cola Ytong (25kg/m²)",
                    "Acero Φ10mm para refuerzos",
                    "Malla electrosoldada Φ4mm",
                    "Nivel láser Bosch GRL300"
                ],
                progress: 50,
                duration: 10,
                action: function() {
                    showNotification("Construyendo muros de carga...", "success");
                    
                    const walls = document.getElementById('walls');
                    walls.style.display = 'block';
                    setTimeout(() => {
                        walls.classList.add('visible');
                    }, 100);
                    
                    // Efectos de construcción
                    createParticles(70, '#f5deb3', 'walls', false, 1000);
                    animateWallConstruction();
                    
                    // Cambiar actividad de trabajadores
                    changeWorkerActivity('walls');
                }
            },
            {
                title: "Techado",
                description: "Estructura de cerchas metálicas galvanizadas (G-90) con cubierta de tejas asfálticas GAF Timberline HD sobre tablero OSB 15mm y barrera de vapor Tyvek HomeWrap.",
                aiComment: "Recomendación: Inclinación mínima 30° para esta zona climática. Use conectores hurricane ties para anclaje estructural. Ventilación de cumbrera y aleros para flujo de aire. Instale ice & water shield en bordes.",
                materials: [
                    "Cerchas metálicas 24ga",
                    "Tejas GAF Timberline HD",
                    "Tablero OSB 15mm",
                    "Membrana Tyvek HomeWrap",
                    "Conectores Simpson H2.5A"
                ],
                progress: 75,
                duration: 8,
                action: function() {
                    showNotification("Instalando estructura del techo...", "success");
                    
                    const roof = document.getElementById('roof');
                    roof.style.display = 'block';
                    setTimeout(() => {
                        roof.classList.add('visible');
                    }, 100);
                    
                    // Efectos de construcción
                    createParticles(40, '#8B0000', 'roof', true, 1500);
                    animateRoofTiles();
                    
                    // Cambiar actividad de trabajadores
                    changeWorkerActivity('roof');
                }
            },
            {
                title: "Acabados",
                description: "Instalación de ventanas de PVC Schüco con doble acristalamiento bajo emisivo (Uw=1.1W/m²K), puerta de entrada blindada Cisa 4 puntos, y acabados interiores con yeso laminado Knauf.",
                aiComment: "Recomendación: Sellado perimetral con cinta butílica y espuma PU de baja expansión. Prueba de hermeticidad blower door test. Use pinturas de bajo VOC para calidad de aire interior. Considere sistema de recuperación de calor HRV.",
                materials: [
                    "Ventanas Schüco AWS 75 (Clase 4)",
                    "Puerta blindada Cisa 2.1x1m",
                    "Yeso laminado Knauf 12.5mm",
                    "Pisos de porcelanato 60x60cm",
                    "Pintura ecológica Graphenstone"
                ],
                progress: 100,
                duration: 12,
                action: function() {
                    showNotification("Instalando acabados finales...", "success");
                    
                    // Mostrar ventanas y puerta
                    const window1 = document.getElementById('window1');
                    const window2 = document.getElementById('window2');
                    const door = document.getElementById('door');
                    
                    window1.style.display = 'block';
                    window2.style.display = 'block';
                    door.style.display = 'block';
                    
                    setTimeout(() => {
                        window1.classList.add('visible');
                        window2.classList.add('visible');
                        door.classList.add('visible');
                    }, 100);
                    
                    // Efectos de instalación
                    createParticles(30, '#87CEEB', 'windows', false, 800);
                    createParticles(20, '#8B4513', 'door', false, 1000);
                    
                    // Ocultar maquinaria pesada
                    document.getElementById('excavator').style.display = 'none';
                    document.getElementById('truck').style.display = 'none';
                    
                    // Cambiar actividad de trabajadores a limpieza
                    changeWorkerActivity('cleaning');
                    
                    // Efecto de finalización
                    setTimeout(() => {
                        createParticles(100, '#FFFFFF', 'all', true, 2000);
                        showNotification("¡Construcción completada con éxito!", "success");
                    }, 1500);
                }
            }
        ];

        // Variables de estado
        let currentStage = 0;
        let autoBuildInterval;
        let weatherMode = 'day';
        let workers = [
            { id: 'worker', position: 10, direction: 1, interval: null },
            { id: 'worker2', position: 20, direction: 1, interval: null }
        ];
        
        // Elementos UI
        const progressBar = document.getElementById('progressBar');
        const stageTitle = document.getElementById('stageTitle');
        const stageDescription = document.getElementById('stageDescription');
        const aiComment = document.getElementById('aiComment');
        const materialsList = document.getElementById('materialsList');
        const prevBtn = document.getElementById('prevStage');
        const nextBtn = document.getElementById('nextStage');
        const autoBtn = document.getElementById('autoBuild');
        const resetBtn = document.getElementById('reset');
        const dayBtn = document.getElementById('dayMode');
        const nightBtn = document.getElementById('nightMode');
        const rainBtn = document.getElementById('rainMode');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        
        // Inicialización
        updateStage();
        setupWeather();
        
        // Funciones principales
        function updateStage() {
            const stage = stages[currentStage];
            
            // Actualizar UI
            progressBar.style.width = stage.progress + '%';
            progressBar.textContent = stage.progress + '% Completado';
            stageTitle.textContent = stage.title;
            stageDescription.textContent = stage.description;
            aiComment.textContent = stage.aiComment;
            
            // Actualizar lista de materiales
            materialsList.innerHTML = '';
            stage.materials.forEach(material => {
                const li = document.createElement('li');
                li.textContent = material;
                materialsList.appendChild(li);
            });
            
            // Actualizar estado de los botones
            prevBtn.disabled = currentStage === 0;
            nextBtn.disabled = currentStage === stages.length - 1;
            
            // Ejecutar acciones de la etapa
            stage.action();
        }
        
        function nextStage() {
            if (currentStage < stages.length - 1) {
                resetCurrentStage();
                currentStage++;
                updateStage();
            }
        }
        
        function prevStage() {
            if (currentStage > 0) {
                resetCurrentStage();
                currentStage--;
                updateStage();
            }
        }
        
        function resetCurrentStage() {
            const stage = stages[currentStage];
            
            // Ocultar elementos mostrados en esta etapa
            switch(currentStage) {
                case 0:
                    document.getElementById('worker').style.display = 'none';
                    document.getElementById('worker2').style.display = 'none';
                    document.getElementById('excavator').style.display = 'none';
                    document.getElementById('truck').style.display = 'none';
                    stopWorkerAnimation();
                    break;
                case 1:
                    document.getElementById('foundation').classList.remove('visible');
                    setTimeout(() => {
                        document.getElementById('foundation').style.display = 'none';
                    }, 1000);
                    break;
                case 2:
                    document.getElementById('walls').classList.remove('visible');
                    setTimeout(() => {
                        document.getElementById('walls').style.display = 'none';
                    }, 1000);
                    break;
                case 3:
                    document.getElementById('roof').classList.remove('visible');
                    setTimeout(() => {
                        document.getElementById('roof').style.display = 'none';
                    }, 1000);
                    break;
                case 4:
                    document.getElementById('window1').classList.remove('visible');
                    document.getElementById('window2').classList.remove('visible');
                    document.getElementById('door').classList.remove('visible');
                    setTimeout(() => {
                        document.getElementById('window1').style.display = 'none';
                        document.getElementById('window2').style.display = 'none';
                        document.getElementById('door').style.display = 'none';
                    }, 1000);
                    break;
            }
        }
        
        function autoBuild() {
            // Deshabilitar botones durante la construcción automática
            prevBtn.disabled = true;
            nextBtn.disabled = true;
            autoBtn.disabled = true;
            resetBtn.disabled = true;
            
            // Configurar el intervalo para avanzar etapas
            let stage = currentStage;
            autoBuildInterval = setInterval(() => {
                if (stage < stages.length) {
                    currentStage = stage;
                    updateStage();
                    stage++;
                } else {
                    clearInterval(autoBuildInterval);
                    
                    // Habilitar botones al finalizar
                    prevBtn.disabled = false;
                    nextBtn.disabled = true;
                    autoBtn.disabled = false;
                    resetBtn.disabled = false;
                }
            }, stages[currentStage].duration * 1000); // Usar duración de la etapa actual
        }
        
        function resetConstruction() {
            // Detener la construcción automática si está en curso
            clearInterval(autoBuildInterval);
            
            // Resetear a la primera etapa
            currentStage = 0;
            
            // Ocultar todos los elementos de construcción
            document.getElementById('foundation').classList.remove('visible');
            document.getElementById('walls').classList.remove('visible');
            document.getElementById('roof').classList.remove('visible');
            document.getElementById('window1').classList.remove('visible');
            document.getElementById('window2').classList.remove('visible');
            document.getElementById('door').classList.remove('visible');
            document.getElementById('worker').style.display = 'none';
            document.getElementById('worker2').style.display = 'none';
            document.getElementById('excavator').style.display = 'none';
            document.getElementById('truck').style.display = 'none';
            
            // Detener animaciones
            stopWorkerAnimation();
            
            setTimeout(() => {
                // Actualizar a la etapa inicial
                updateStage();
                
                // Restablecer botones
                prevBtn.disabled = true;
                nextBtn.disabled = false;
                autoBtn.disabled = false;
            }, 1000);
        }
        
        // Funciones de animación
        function animateWorker() {
            const worker = workers[0];
            const element = document.getElementById(worker.id);
            
            worker.interval = setInterval(() => {
                worker.position += worker.direction * 0.3;
                element.style.left = worker.position + '%';
                
                if (worker.position >= 70 || worker.position <= 10) {
                    worker.direction *= -1;
                    element.style.transform = worker.direction === 1 ? 'scaleX(1) translateZ(25px)' : 'scaleX(-1) translateZ(25px)';
                }
                
                // Crear partículas de movimiento
                if (Math.random() > 0.7) {
                    createParticle(
                        worker.position + 15,
                        25,
                        '#3498db',
                        2 + Math.random() * 3,
                        1000
                    );
                }
            }, 50);
        }
        
        function animateWorker2() {
            const worker = workers[1];
            const element = document.getElementById(worker.id);
            
            worker.interval = setInterval(() => {
                worker.position += worker.direction * 0.2;
                element.style.left = worker.position + '%';
                
                if (worker.position >= 60 || worker.position <= 20) {
                    worker.direction *= -1;
                    element.style.transform = worker.direction === 1 ? 'scaleX(1) translateZ(25px)' : 'scaleX(-1) translateZ(25px)';
                }
                
                // Crear partículas de movimiento
                if (Math.random() > 0.8) {
                    createParticle(
                        worker.position + 15,
                        25,
                        '#e74c3c',
                        2 + Math.random() * 3,
                        1000
                    );
                }
            }, 70);
        }
        
        function stopWorkerAnimation() {
            workers.forEach(worker => {
                if (worker.interval) {
                    clearInterval(worker.interval);
                    worker.interval = null;
                }
            });
        }
        
        function changeWorkerActivity(activity) {
            // Cambiar color de los trabajadores según actividad
            const worker1 = document.getElementById('worker').querySelector('.worker-body');
            const worker2 = document.getElementById('worker2').querySelector('.worker-body');
            
            switch(activity) {
                case 'foundation':
                    worker1.style.background = 'linear-gradient(to bottom, #3498db, #2980b9)';
                    worker2.style.background = 'linear-gradient(to bottom, #3498db, #2980b9)';
                    break;
                case 'walls':
                    worker1.style.background = 'linear-gradient(to bottom, #f39c12, #e67e22)';
                    worker2.style.background = 'linear-gradient(to bottom, #f39c12, #e67e22)';
                    break;
                case 'roof':
                    worker1.style.background = 'linear-gradient(to bottom, #e74c3c, #c0392b)';
                    worker2.style.background = 'linear-gradient(to bottom, #e74c3c, #c0392b)';
                    break;
                case 'cleaning':
                    worker1.style.background = 'linear-gradient(to bottom, #2ecc71, #27ae60)';
                    worker2.style.background = 'linear-gradient(to bottom, #2ecc71, #27ae60)';
                    break;
            }
        }
        
        function animateExcavator() {
            const excavator = document.getElementById('excavator');
            let position = -120;
            
            function move() {
                position += 0.5;
                excavator.style.left = position + 'px';
                
                // Crear partículas de humo
                if (Math.random() > 0.9) {
                    createParticle(
                        position + 50,
                        27,
                        '#555',
                        4 + Math.random() * 3,
                        2000,
                        true
                    );
                }
                
                if (position > window.innerWidth) {
                    position = -120;
                }
            }
            
            // Iniciar animación
            setInterval(move, 30);
        }
        
        function animateTruck() {
            const truck = document.getElementById('truck');
            let position = -150;
            
            function move() {
                position += 1;
                truck.style.left = position + 'px';
                
                // Crear partículas de humo
                if (Math.random() > 0.85) {
                    createParticle(
                        position + 20,
                        27,
                        '#333',
                        3 + Math.random() * 2,
                        1500,
                        true
                    );
                }
                
                if (position > window.innerWidth) {
                    position = -150;
                    // Crear efecto de nuevo camión entrando
                    setTimeout(() => {
                        createParticles(20, '#e74c3c', 'left', false, 500);
                    }, 500);
                }
            }
            
            // Iniciar animación
            setInterval(move, 40);
        }
        
        function animateWallConstruction() {
            // Simular colocación de bloques
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    createParticles(8, '#f5deb3', 'walls', false, 800);
                    flashElement(document.getElementById('walls'), 1, 200);
                }, i * 600);
            }
        }
        
        function animateRoofTiles() {
            // Simular colocación de tejas
            const roof = document.getElementById('roof');
            for (let i = 0; i < 12; i++) {
                setTimeout(() => {
                    const tile = document.createElement('div');
                    tile.style.position = 'absolute';
                    tile.style.width = '25px';
                    tile.style.height = '12px';
                    tile.style.backgroundColor = i % 2 === 0 ? '#8B0000' : '#700000';
                    tile.style.left = (25 + i * 4) + '%';
                    tile.style.bottom = (66 - i * 0.4) + '%';
                    tile.style.transform = 'rotate(' + (i * 1.5 - 6) + 'deg) translateZ(45px)';
                    tile.style.zIndex = '7';
                    tile.style.boxShadow = '0 2px 5px rgba(0,0,0,0.3)';
                    roof.appendChild(tile);
                    
                    // Animación de aparición
                    tile.style.opacity = '0';
                    tile.style.transform += ' translateY(-20px)';
                    setTimeout(() => {
                        tile.style.opacity = '1';
                        tile.style.transform = 'rotate(' + (i * 1.5 - 6) + 'deg) translateZ(45px)';
                    }, 200);
                    
                    // Efecto sonoro visual
                    if (i % 3 === 0) {
                        createParticle(
                            25 + i * 4 + 12,
                            66 - i * 0.4,
                            '#8B0000',
                            3,
                            500,
                            true
                        );
                    }
                }, i * 400);
            }
        }
        
        // Sistema de partículas mejorado
        function createParticles(count, color, area, rise = false, duration = 1000) {
            const container = document.getElementById('particles-container');
            
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    let left, bottom;
                    
                    // Posicionar según el área especificada
                    switch(area) {
                        case 'bottom':
                            left = 20 + Math.random() * 60;
                            bottom = 25;
                            break;
                        case 'foundation':
                            left = 30 + Math.random() * 40;
                            bottom = 25 + Math.random() * 3;
                            break;
                        case 'walls':
                            left = 30 + Math.random() * 40;
                            bottom = 31 + Math.random() * 35;
                            break;
                        case 'roof':
                            left = 25 + Math.random() * 50;
                            bottom = 66 + Math.random() * 15;
                            break;
                        case 'windows':
                            left = Math.random() > 0.5 ? 35 : 57;
                            left += Math.random() * 5 - 2.5;
                            bottom = 50 + Math.random() * 5;
                            break;
                        case 'door':
                            left = 45 + Math.random() * 10;
                            bottom = 31 + Math.random() * 22;
                            break;
                        case 'left':
                            left = 5 + Math.random() * 10;
                            bottom = 25 + Math.random() * 10;
                            break;
                        default:
                            left = Math.random() * 80 + 10;
                            bottom = Math.random() * 60 + 20;
                    }
                    
                    createParticle(left, bottom, color, 2 + Math.random() * 4, duration, rise);
                }, i * 50);
            }
        }
        
        function createParticle(left, bottom, color, size = 3, duration = 1000, rise = false) {
            const particle = document.createElement('div');
            particle.className = 'construction-particle';
            
            // Asignar clase según color
            if (color === '#f5deb3' || color === '#d2b48c') {
                particle.classList.add('wood-particle');
            } else if (color === '#696969' || color === '#808080') {
                particle.classList.add('concrete-particle');
            } else if (color === '#8B0000' || color === '#c0392b') {
                particle.classList.add('brick-particle');
            } else {
                particle.style.backgroundColor = color;
            }
            
            particle.style.width = size + 'px';
            particle.style.height = size + 'px';
            particle.style.left = left + '%';
            particle.style.bottom = bottom + '%';
            particle.style.transform = 'translateZ(' + (20 + Math.random() * 30) + 'px)';
            
            document.getElementById('particles-container').appendChild(particle);
            
            // Animación
            const animation = particle.animate([
                { opacity: 0.8, transform: particle.style.transform + ' scale(1)' },
                { 
                    opacity: 0, 
                    transform: particle.style.transform + 
                        (rise ? ' translateY(-40px) scale(0.3)' : ' translateY(20px) scale(0.3)'),
                    left: (left + (Math.random() * 6 - 3)) + '%'
                }
            ], {
                duration: duration + Math.random() * 500,
                easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
            });
            
            animation.onfinish = () => {
                particle.remove();
            };
        }
        
        // Sistema de clima
        function setupWeather() {
            // Configurar nubes
            const weather = document.querySelector('.weather');
            
            // Crear más nubes
            for (let i = 0; i < 5; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                cloud.style.top = (10 + Math.random() * 30) + '%';
                cloud.style.left = (Math.random() * 80) + '%';
                cloud.style.width = (60 + Math.random() * 80) + 'px';
                cloud.style.height = (30 + Math.random() * 50) + 'px';
                cloud.style.opacity = 0.7 + Math.random() * 0.3;
                weather.appendChild(cloud);
                
                // Animación de nubes
                animateCloud(cloud);
            }
        }
        
        function animateCloud(cloud) {
            let position = parseFloat(cloud.style.left);
            
            function move() {
                position += 0.01;
                if (position > 100) position = -20;
                cloud.style.left = position + '%';
            }
            
            setInterval(move, 50);
        }
        
        function setWeather(mode) {
            weatherMode = mode;
            const constructionSite = document.querySelector('.construction-site');
            const weather = document.querySelector('.weather');
            
            // Limpiar clima anterior
            document.querySelectorAll('.rain').forEach(el => el.remove());
            document.querySelector('.moon')?.remove();
            
            // Aplicar nuevo clima
            switch(mode) {
                case 'day':
                    constructionSite.classList.remove('night-mode');
                    weather.style.background = 'none';
                    break;
                    
                case 'night':
                    constructionSite.classList.add('night-mode');
                    weather.style.background = 'none';
                    
                    // Crear luna
                    const moon = document.createElement('div');
                    moon.className = 'moon';
                    weather.appendChild(moon);
                    break;
                    
                case 'rain':
                    constructionSite.classList.remove('night-mode');
                    weather.style.background = 'rgba(0,0,0,0.3)';
                    
                    // Crear lluvia
                    for (let i = 0; i < 60; i++) {
                        const rain = document.createElement('div');
                        rain.className = 'rain';
                        rain.style.left = Math.random() * 100 + '%';
                        rain.style.top = Math.random() * 100 + '%';
                        rain.style.animationDuration = (0.5 + Math.random() * 0.5) + 's';
                        rain.style.animationDelay = Math.random() + 's';
                        weather.appendChild(rain);
                    }
                    break;
            }
        }
        
        // Efectos visuales
        function flashElement(element, count, duration) {
            if (!element) return;
            
            let flashes = 0;
            const originalBg = element.style.backgroundColor;
            
            function flash() {
                if (flashes >= count * 2) {
                    element.style.backgroundColor = originalBg;
                    return;
                }
                
                element.style.backgroundColor = flashes % 2 === 0 ? 'rgba(255,255,255,0.8)' : originalBg;
                flashes++;
                
                setTimeout(flash, duration);
            }
            
            flash();
        }
        
        // Sistema de notificaciones
        function showNotification(message, type = 'info') {
            notificationText.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Event listeners
        nextBtn.addEventListener('click', nextStage);
        prevBtn.addEventListener('click', prevStage);
        autoBtn.addEventListener('click', autoBuild);
        resetBtn.addEventListener('click', resetConstruction);
        dayBtn.addEventListener('click', () => setWeather('day'));
        nightBtn.addEventListener('click', () => setWeather('night'));
        rainBtn.addEventListener('click', () => setWeather('rain'));
    </script>
</body>
</html>